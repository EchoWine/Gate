{{extends Admin/admin/layout}}

{{block page-content}}
	
	<div class='templates' data-template='spinner-table'>

		<div class='table-row'>
			<div class='table-col'>
				{{include Admin/admin/__spinner}}
			</div>
		</div>

	</div>
	
	<!-- ALERT DETAILS -->
	<div class='templates' data-template='alert-details'>
		<li>{message}</li>
	</div>

	<!-- ALERT SUCCESS TEMPLATE -->	
	<div class='templates' data-template='alert-success'>
		<div class='alert alert-success'>{message}<ul>{details}</ul></div>
	</div>

	<!-- ALERT DANGER TEMPLATE -->
	<div class='templates' data-template='alert-danger'>
		<div class='alert alert-danger'>{message}<ul>{details}</ul></div>
	</div>


	<!-- MODAL ADD -->
	{{includes Admin/admin/__modal modal-add}}
		{{block __class}}{{/block}}
		{{block id}}modal-item-add{{/block}}
		{{block title}}Add new row{{/block}}
		{{block content}}
			<div data-use-template='alert-modal-add'></div>
			<form method='POST' item-data-form-add  data-item-table='{table}'>
				{{for $fields_add as $field}}
					<div class='item-form-label'>{{$field -> getLabel()}}:</div>
					<div class='item-form-input'>{{include Admin/admin/field ['field' => $field,'extra_class' => 'item-form-element']}}</div>
				{{/for}}

				<div class='item-form-actions'><button type='submit' class='button-action button-primary'>Add</button></div>
			</form>
		{{/block}}
	{{/includes}}


	<!-- MODAL VIEW -->
	{{includes Admin/admin/__modal modal-get}}
		{{block __class}}{{/block}}
		{{block id}}modal-item-get{{/block}}
		{{block title}}View{{/block}}
		{{block content}}

			{{for $fields_get as $field}}
				<div class='item-form-label'>{{$field -> getLabel()}}</div>
				<div class='item-form-input'><span data-name='{{$field -> getName()}}'></span></div>
			{{/for}}

			<div class='item-form-actions'>
				
				{# Edit Button #}
				<button type='button' class='button-action button-warning' data-modal='modal-item-edit' data-modal-item-id='{id}' data-modal-item-table='{table}'>
					<i class='fa fa-pencil'></i>
					<span>Edit</span>
				</button>

				{# Delete Button #}
				<button type='button' class='button-action button-danger' data-modal='modal-item-delete' data-modal-item-id='{id}' data-modal-item-table='{table}'>
					<i class='fa fa-trash'></i>
					<span>Delete</span>
				</button>
			</div>

		{{/block}}
	{{/includes}}

	<!-- MODAL EDIT -->
	{{includes Admin/admin/__modal modal-edit}}
		{{block __class}}{{/block}}
		{{block id}}modal-item-edit{{/block}}
		{{block title}}Edit{{/block}}
		{{block content}}
			<div data-use-template='alert-modal-edit'></div>
			<form method='POST' item-data-form-edit data-item-table='{table}' data-item-id='{id}'>
				{{for $fields_edit as $field}}
					<div class='item-form-label'>{{$field -> getLabel()}}:</div>
					<div class='item-form-input'><input type='text' class='input-data' name='{{$field -> getName()}}'></div>
				{{/for}}

				<div class='item-form-actions'><button type='submit' class='button-action button-primary'>Apply changes</button></div>
			</form>
		{{/block}}
	{{/includes}}


	<!-- MODAL DELETE CONFIRM -->
	{{includes Admin/admin/__modal modal-delete}}
		{{block __class}}modal-body-small{{/block}}
		{{block id}}modal-item-delete{{/block}}
		{{block title}}Are you sure?{{/block}}
		{{block content}}
			<form method='POST'>
				<div>The item #<span class='data-modal-item-id'></span> will be deleted</div>
				<div class='item-form-actions'>
					<button type='button' class='button-action button-primary' data-item-remove data-item-id='{id}' data-item-table='{table}'>
						<i class='fa fa-check'></i>
						<span>Yes</span>
					</button>
					<button type='button' class='button-action button-danger modal-close'>
						<i class='fa fa-remove'></i>
						<span>No</span>
					</button>
				</div>
			</form>
		{{/block}}
	{{/includes}}


	<!-- ROW TEMPLATE -->
	<div class='templates' data-template='item-row'>
		<div class='table-row table-header'>
			<div class='table-col-select table-col'>
				<input type='checkbox' id='select-{table}-{id}' class='check check-data check-small' data-item-select data-item-id='{id}' data-item-table='{table}'>
				<label for='select-{table}-{id}' class='checkbox'></label>
			</div>
			{{for $fields_all as $field}}
				<div class='table-col {# {{if $field -> isClassNumber() }}table-col-number{{/if}} #}'>
					<span class='table-col-text'>{{tmpl_js_var($field -> getName())}}</span>
				</div>
			{{/for}}
			<div class='table-col table-col-action'>

				{# View Button #}
				<button type='button' class='button-action button-action-icon button-info' data-modal='modal-item-get' data-modal-item-id='{id}' data-modal-item-table='{table}'>
					<i class="fa fa-file-text"></i>
				</button>

				{# Copy Button #}
				<button type='button' class='button-action button-action-icon button-primary' data-item-copy data-item-id='{id}' data-item-table='{table}'>
					<i class="fa fa-copy"></i>
				</button>

				{# Edit Button #}
				<button type='button' class='button-action button-action-icon button-warning' data-modal='modal-item-edit' data-modal-item-id='{id}' data-modal-item-table='{table}'>
					<i class='fa fa-pencil'></i>
				</button>
					
				{# Delete Button #}
				<button type='button' class='button-action button-action-icon button-danger' data-modal='modal-item-delete' data-modal-item-id='{id}' data-modal-item-table='{table}'>
					<i class='fa fa-trash'></i>
				</button>
			</div>

		</div>
	</div>
	<div class='page-section'>
		<div data-use-template='alert-global'></div>
	</div>

	<div class='page-row'>
		<div class='page-section page-section-content' data-item-table-container='{{$table}}'>


			<div class='section-header flex-center'>
				<h3 class='section-title'>Some content here...</h3>

				<div class='flex-fill'></div>
				
				<div class='section-actions'>


					<button type='button' class='button-action button-primary' data-modal='modal-item-add' data-modal-item-table='{{$table}}'>
						<i class='fa fa-plus'></i>
						<span>New</span>
					</button>

					<!--
					<button type='button' class='button-action button-primary' data-modal='modal-item-add' data-modal-item-table='{{$table}}'>
						<i class='fa fa-upload'></i>
						<span>Import</span>
					</button>

					<button type='button' class='button-action button-primary' data-modal='modal-item-add' data-modal-item-table='{{$table}}'>
						<i class='fa fa-download'></i>
						<span>Export</span>
					</button>
					-->

				</div>
			</div>
			

			<div class='section-pagination flex-center'>
				<div>If selected: &nbsp;</div>

				<button type='button' class='button-action button-danger'  data-item-table='{{$table}}' data-item-multiple-delete>
					<i class='fa fa-trash'></i>
					<span>Delete</span>
				</button>
				<div> &nbsp;</div>
				<button type='button' class='button-action button-warning'>
					<i class='fa fa-pencil'></i>
					<span>Edit</span>
				</button>
				<div> &nbsp;</div>
				<button type='button' class='button-action button-primary'>
					<i class='fa fa-file-o'></i>
					<span>Copy</span>
				</button>
				<div> &nbsp;</div>

				<div class='flex-fill'></div>
				<div>
					Page <span data-item-list-page>1</span> of <span data-item-list-pages>1</span> | 
					Showing <span data-item-list-start>1</span> to <span data-item-list-end>1</span> 
					of <span data-item-list-count>1</span> entries 
					<button type='button' class='button-action' data-item-list-prev data-item-table='{{$table}}'>Previous</button>
					<button type='button' class='button-action' data-item-list-next data-item-table='{{$table}}'>Next</button>
				</div>
			</div>

			<div class='table'>

				<div class='table-row table-header'>

					{# Head #}

					<div class='table-col-select table-col table-col-head'>
							
						<input type='checkbox' id='select-all-{table}' class='check check-data check-small' data-item-select-all data-item-table='{{$table}}'>
						<label for='select-all-{table}' class='checkbox'></label>

					</div>
					{{for $fields_all as $field}}
						{{if $field -> isSort()}}
							<div class='table-col table-col-head table-col-sort {# {{if $field -> isClassNumber() }}table-col-number{{/if}} #}' data-item-sort-field='{{$field -> getName()}}' data-item-table='{{$table}}'>
								<div class='table-col-text noselect'>
									<span>{{$field -> getLabel()}}</span>

									<i class='fa fa-sort' data-item-sort-none></i>
									<i class='fa fa-sort-asc hide' data-item-sort-asc></i>
									<i class='fa fa-sort-desc hide' data-item-sort-desc></i>
								</div>
							</div>
						{{else}}

							<div class='table-col table-col-head'>
								<div class='table-col-text'>
									<span>{{$field -> getLabel()}}</span>
								</div>
							</div>
						{{/if}}
					{{/for}}
					<div class='table-col table-col-action'>
						<div class='table-col-text'>
							<span>Action</span>
						</div>
					</div>

				</div>

				{# Search #}

				<div class='table-row table-header table-row-search'>
					<div class='table-col-select table-col table-col-head'></div>
					{{for $fields_search as $field}}

						<div class='table-col table-col-head table-col-search'>
							<input type='text' class='input-data' name='{{$field -> getName()}}'>
						</div>

					{{/for}}
					<div class='table-col table-col-action'>
						<button type='button' class='button-action button-action-icon button-primary' data-item-search data-item-table='{{$table}}'>
							<i class='fa fa-search'></i>
						</button>
					</div>
				</div>


				<div data-use-template='item-row'>
					<div class='table-row'>
						<div class='table-col'>
							{{include Admin/admin/__spinner}}
						</div>
					</div>
				</div>

			</div>
			<div class='section-pagination flex-center'>
				<div>
					<select class='select select-data' data-item-show data-item-table='{{$table}}'>
						<option value='10'>10</option>
						<option value='25'>25</option>
						<option value='50'>50</option>
						<option value='100'>100</option>
					</select>
				</div>
				<div class='flex-fill'></div>
				<div>
					Page <span data-item-list-page>1</span> of <span data-item-list-pages>1</span> | 
					Showing <span data-item-list-start>1</span> to <span data-item-list-end>1</span> 
					of <span data-item-list-count>1</span> entries 
					<button type='button' class='button-action' data-item-list-prev data-item-table='{{$table}}'>Previous</button>
					<button type='button' class='button-action' data-item-list-next data-item-table='{{$table}}'>Next</button>
				</div>
			</div>
		</div>
	</div>
{{/block}}

{{block scripts}}
	{{parent}}
	<script>
		item.addTable({
			name:'{{$table}}',
			url:'{{$api}}',
			list:{
				sort_by_field:'{{$sort_by_field}}',
				sort_by_direction:'{{$sort_by_direction}}',
				show:10,
				page:1
			},
			get:{
				get: function(container,data){
					{{for $fields_get as $field}}
						container.find('[data-name={{$field -> getName()}}]').html(data['{{$field -> getName()}}']);
					{{/for}}
				},
			},
			add:{
				form: '#item-data-form-add',
				action: function(form){
					var values = {};

					{{for $fields_add as $field}}
						values.{{$field -> getName()}} = form.find('[name={{$field -> getName()}}]').val();
					{{/for}}
					return values;
				}
			},
			delete:{
				form: '#item-data-form-add',
			},
			copy:{

			},
			edit:{
				get: function(container,data){
					{{for $fields_edit as $field}}
						container.find('[name={{$field -> getName()}}]').val(data['{{$field -> getName()}}']);
					{{/for}}
				},
				action: function(form){
					var values = {};

					{{for $fields_edit as $field}}
						values.{{$field -> getName()}} = form.find('[name={{$field -> getName()}}]').val();
					{{/for}}
					return values;
				}
			},
			search:{
				data: {},
				action: function(form){
					console.log(form);
					var values = {};

					{{for $fields_search as $field}}
						if(form.find('[name={{$field -> getName()}}]').val() !== '')
							values.{{$field -> getName()}} = form.find('[name={{$field -> getName()}}]').val();
					{{/for}}
					return values;
				}
			},
			template: {
				row: 'item-row'
			},

		});
	</script>
{{/block}}